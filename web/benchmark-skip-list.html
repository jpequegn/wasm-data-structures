<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skip List Benchmark</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121317;
            color: #E0E6F0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #1F4E8C;
        }

        .subtitle {
            text-align: center;
            color: #A3A9BF;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls {
            background-color: #1E2130;
            padding: 20px;
            border-radius: 2px;
            margin-bottom: 30px;
            border: 1px solid #333A56;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #A3A9BF;
            font-size: 14px;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 2px;
            background-color: #1F4E8C;
            color: white;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #2762B3;
        }

        button:disabled {
            background-color: #555D7A;
            cursor: not-allowed;
        }

        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .benchmark-box {
            background-color: #1E2130;
            padding: 20px;
            border-radius: 2px;
            border: 1px solid #333A56;
        }

        .benchmark-box h3 {
            margin-bottom: 15px;
            color: #1F4E8C;
            font-size: 16px;
        }

        .metrics {
            display: grid;
            gap: 10px;
        }

        .metric-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 8px;
            background-color: #2A2F45;
            border-radius: 2px;
        }

        .metric-label {
            color: #A3A9BF;
            font-size: 13px;
        }

        .metric-value {
            color: #FFC107;
            font-weight: 600;
            font-size: 13px;
        }

        .comparison-table {
            width: 100%;
            background-color: #1E2130;
            border-collapse: collapse;
            margin-bottom: 30px;
            border: 1px solid #333A56;
        }

        .comparison-table thead {
            background-color: #2A2F45;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333A56;
            font-size: 13px;
        }

        .comparison-table th {
            color: #1F4E8C;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background-color: #2A2F45;
        }

        .status {
            text-align: center;
            color: #A3A9BF;
            margin: 20px 0;
            font-size: 14px;
        }

        .error {
            color: #DC3545;
        }

        .success {
            color: #28A745;
        }

        .info-box {
            background-color: #1E2130;
            padding: 15px;
            border-left: 3px solid #1F4E8C;
            margin-bottom: 20px;
            border-radius: 2px;
            font-size: 13px;
            color: #A3A9BF;
        }

        .info-box strong {
            color: #E0E6F0;
        }

        .speedup {
            color: #28A745;
            font-weight: 600;
        }

        .speedup.slow {
            color: #FFC107;
        }

        input[type="number"] {
            padding: 8px 12px;
            background-color: #1E2130;
            color: #E0E6F0;
            border: 1px solid #333A56;
            border-radius: 2px;
            font-size: 14px;
            width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Skip List Benchmark</h1>
        <p class="subtitle">Probabilistic self-balancing without rotations</p>

        <div class="info-box">
            <strong>Skip List:</strong> A probabilistic data structure that achieves O(log n) operations without complex rotations or color rules.
            Uses randomization to decide node levels, creating a multi-level linked list where higher levels "skip" over more elements.
            This benchmark demonstrates how randomization can achieve the same performance as deterministic balanced trees with much simpler code.
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Insertion Pattern:</label>
                <div class="button-group">
                    <button onclick="runBenchmarkPattern('random')">Random Order</button>
                    <button onclick="runBenchmarkPattern('sequential')">Sequential (1,2,3...)</button>
                    <button onclick="runBenchmarkPattern('reverse')">Reverse Order</button>
                </div>
            </div>

            <div class="control-group">
                <label>Item Count:</label>
                <input type="number" id="itemCount" value="5000" min="100" max="50000">
            </div>

            <div class="control-group">
                <label>Comparison:</label>
                <div class="button-group">
                    <button onclick="runComparisonBenchmark()">JS vs WASM</button>
                    <button onclick="clearResults()">Clear Results</button>
                </div>
            </div>
        </div>

        <div id="status" class="status"></div>

        <table class="comparison-table" id="resultsTable" style="display: none;">
            <thead>
                <tr>
                    <th>Implementation</th>
                    <th>Insert Time (ms)</th>
                    <th>Average Level</th>
                    <th>Max Level</th>
                    <th>Search Comparisons</th>
                </tr>
            </thead>
            <tbody id="resultsBody">
            </tbody>
        </table>

        <div class="benchmark-grid">
            <div class="benchmark-box">
                <h3>JavaScript Implementation</h3>
                <div class="metrics" id="jsMetrics">
                    <p style="color: #A3A9BF; font-size: 13px;">No results yet</p>
                </div>
            </div>

            <div class="benchmark-box">
                <h3>Rust/WASM Implementation</h3>
                <div class="metrics" id="wasmMetrics">
                    <p style="color: #A3A9BF; font-size: 13px;">No results yet</p>
                </div>
            </div>
        </div>
    </div>

    <script src="SkipList.js"></script>
    <script src="benchmark-wasm.js"></script>

    <script>
        function getItemCount() {
            return parseInt(document.getElementById('itemCount').value) || 5000;
        }

        function generateData(count, pattern) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(i);
            }

            if (pattern === 'random') {
                // Fisher-Yates shuffle
                for (let i = data.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [data[i], data[j]] = [data[j], data[i]];
                }
            } else if (pattern === 'reverse') {
                data.reverse();
            }
            // 'sequential' is already in order

            return data;
        }

        async function runBenchmarkPattern(pattern) {
            const count = getItemCount();
            setStatus(`Running ${pattern} insertion benchmark with ${count} items...`);
            clearMetrics();

            const data = generateData(count, pattern);

            // Wait for WASM to load
            const loaded = await initWasm();
            if (!loaded) {
                setStatus('Error: Could not load WASM module', true);
                return;
            }

            // Benchmark JS
            const jsStart = performance.now();
            const jsResult = benchmarkJSSkipList(count);
            const jsTime = performance.now() - jsStart;

            // Benchmark WASM
            const wasmStart = performance.now();
            const wasmResult = await benchmarkWasmSkipList(count);
            const wasmTime = performance.now() - wasmStart;

            if (!wasmResult) {
                setStatus('Error: WASM benchmark failed', true);
                return;
            }

            // Display results
            displayResults(jsResult, jsTime, wasmResult, wasmTime);
            setStatus(`Benchmark complete! (${pattern} pattern)`, false, true);
        }

        async function runComparisonBenchmark() {
            const count = getItemCount();
            setStatus(`Running side-by-side comparison with ${count} items (random pattern)...`);
            clearMetrics();

            // Wait for WASM to load
            const loaded = await initWasm();
            if (!loaded) {
                setStatus('Error: Could not load WASM module', true);
                return;
            }

            // Benchmark JS
            const jsStart = performance.now();
            const jsResult = benchmarkJSSkipList(count);
            const jsTime = performance.now() - jsStart;

            // Benchmark WASM
            const wasmStart = performance.now();
            const wasmResult = await benchmarkWasmSkipList(count);
            const wasmTime = performance.now() - wasmStart;

            if (!wasmResult) {
                setStatus('Error: WASM benchmark failed', true);
                return;
            }

            // Display results
            displayResults(jsResult, jsTime, wasmResult, wasmTime);
            setStatus('Comparison complete!', false, true);
        }

        function displayResults(jsMetrics, jsTime, wasmMetrics, wasmTime) {
            // Update individual boxes
            const jsHtml = `
                <div class="metric-row">
                    <span class="metric-label">Insert Time</span>
                    <span class="metric-value">${jsTime.toFixed(2)}ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Average Level</span>
                    <span class="metric-value">${jsMetrics.averageLevel.toFixed(2)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Max Level</span>
                    <span class="metric-value">${jsMetrics.maxLevel}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Total Insertions</span>
                    <span class="metric-value">${jsMetrics.totalInsertions}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Search Comparisons</span>
                    <span class="metric-value">${jsMetrics.searchComparisons}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Insertion Cost</span>
                    <span class="metric-value">${jsMetrics.insertionCost}</span>
                </div>
            `;

            const wasmHtml = `
                <div class="metric-row">
                    <span class="metric-label">Insert Time</span>
                    <span class="metric-value">${wasmTime.toFixed(2)}ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Average Level</span>
                    <span class="metric-value">${wasmMetrics.averageLevel.toFixed(2)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Max Level</span>
                    <span class="metric-value">${wasmMetrics.maxLevel}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Total Insertions</span>
                    <span class="metric-value">${wasmMetrics.totalInsertions}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Search Comparisons</span>
                    <span class="metric-value">${wasmMetrics.searchComparisons}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Insertion Cost</span>
                    <span class="metric-value">${wasmMetrics.insertionCost}</span>
                </div>
            `;

            document.getElementById('jsMetrics').innerHTML = jsHtml;
            document.getElementById('wasmMetrics').innerHTML = wasmHtml;

            // Update comparison table
            const speedup = (jsTime / wasmTime).toFixed(2);
            const speedupClass = speedup > 1.5 ? 'speedup' : 'speedup slow';

            // Calculate theoretical max level for comparison
            const count = jsMetrics.totalInsertions;
            const theoreticalMaxLevel = Math.ceil(Math.log2(count));

            const tableHtml = `
                <tr>
                    <td>JavaScript</td>
                    <td>${jsTime.toFixed(2)}ms</td>
                    <td>${jsMetrics.averageLevel.toFixed(2)}</td>
                    <td>${jsMetrics.maxLevel}</td>
                    <td>${jsMetrics.searchComparisons}</td>
                </tr>
                <tr>
                    <td>Rust/WASM</td>
                    <td>${wasmTime.toFixed(2)}ms</td>
                    <td>${wasmMetrics.averageLevel.toFixed(2)}</td>
                    <td>${wasmMetrics.maxLevel}</td>
                    <td>${wasmMetrics.searchComparisons}</td>
                </tr>
                <tr style="background-color: #333A56;">
                    <td><strong>Speedup (WASM)</strong></td>
                    <td><span class="${speedupClass}">${speedup}x</span></td>
                    <td colspan="3" style="text-align: center; color: #A3A9BF;">
                        Theoretical max level: ${theoreticalMaxLevel} (logâ‚‚(${count}) â‰ˆ ${Math.log2(count).toFixed(1)})
                    </td>
                </tr>
            `;

            document.getElementById('resultsBody').innerHTML = tableHtml;
            document.getElementById('resultsTable').style.display = 'table';
        }

        function clearMetrics() {
            document.getElementById('jsMetrics').innerHTML = '<p style="color: #A3A9BF; font-size: 13px;">Running...</p>';
            document.getElementById('wasmMetrics').innerHTML = '<p style="color: #A3A9BF; font-size: 13px;">Running...</p>';
        }

        function clearResults() {
            document.getElementById('jsMetrics').innerHTML = '<p style="color: #A3A9BF; font-size: 13px;">No results yet</p>';
            document.getElementById('wasmMetrics').innerHTML = '<p style="color: #A3A9BF; font-size: 13px;">No results yet</p>';
            document.getElementById('resultsTable').style.display = 'none';
            setStatus('Results cleared', false, false);
        }

        function setStatus(message, isError = false, isSuccess = false) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status';
            if (isError) statusEl.classList.add('error');
            if (isSuccess) statusEl.classList.add('success');
        }
    </script>
</body>
</html>
